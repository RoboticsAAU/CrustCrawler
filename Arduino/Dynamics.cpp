#include "Dynamics.h"  

Dynamics::Dynamics(ComputerConnection* pointer) : pComCon(pointer) {}

// Function that calculates the inverse dynamics for a given position, velocity, and acceleration, i.e. it returns the torque required for a given motion
JointTorques Dynamics::InverseDynamics(JointAngles& positions, Velocities& velocities, Accelerations& accelerations)
{
	// Converting position and velocity to SI-units
	positions.ConvertTo(Radians);
	velocities.ConvertTo(RadiansPerSec);

	JointTorques returnJointTorques;
	
	// Torques for the three modelled joints (using measured masses):
	returnJointTorques.torques[1] = ((-0.1647e-1 + (0.4e-5 * pow(cos(positions.thetas[1]), 0.2e1) - 0.1300e-1) * pow(cos(positions.thetas[3]), 0.2e1) - 0.1885e-1 * cos(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + (0.1885e-1 * sin(positions.thetas[2]) * sin(positions.thetas[3]) + 0.1300e-1 * sin(positions.thetas[3]) * sin(positions.thetas[2]) * cos(positions.thetas[3])) * cos(positions.thetas[2]) + 0.6498e-2 * pow(cos(positions.thetas[3]), 0.2e1) + 0.1885e-1 * cos(positions.thetas[3]) + 0.2337e-1) * accelerations.accelerations[1] - 0.2e-5 * accelerations.accelerations[2] * cos(positions.thetas[1]) * cos(positions.thetas[2]) * sin(positions.thetas[1]) * sin(positions.thetas[2]) * cos(positions.thetas[3]) + ((-0.10e-4 * cos(positions.thetas[1]) * sin(positions.thetas[1]) - 0.2e-5 * cos(positions.thetas[1]) * sin(positions.thetas[1]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + (0.2e-5 * cos(positions.thetas[1]) * sin(positions.thetas[2]) * sin(positions.thetas[1]) * sin(positions.thetas[3]) + 0.4e-5 * cos(positions.thetas[1]) * sin(positions.thetas[2]) * cos(positions.thetas[3]) * sin(positions.thetas[1]) * sin(positions.thetas[3])) * cos(positions.thetas[2]) + 0.2e-5 * cos(positions.thetas[1]) * sin(positions.thetas[1]) * cos(positions.thetas[3]) + 0.10e-4 * cos(positions.thetas[1]) * sin(positions.thetas[1])) * pow(velocities.velocities[1], 0.2e1) + ((((0.2e-4 * pow(cos(positions.thetas[1]), 0.2e1) * sin(positions.thetas[3]) + 0.2598e-1 * sin(positions.thetas[3])) * cos(positions.thetas[3]) + 0.3770e-1 * sin(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + ((0.2e-4 * pow(cos(positions.thetas[1]), 0.2e1) * sin(positions.thetas[2]) + 0.2598e-1 * sin(positions.thetas[2])) * pow(cos(positions.thetas[3]), 0.2e1) + 0.3770e-1 * sin(positions.thetas[2]) * cos(positions.thetas[3]) + 0.3293e-1 * sin(positions.thetas[2]) - 0.1e-4 * pow(cos(positions.thetas[1]), 0.2e1) * sin(positions.thetas[2])) * cos(positions.thetas[2]) + (-0.1299e-1 * sin(positions.thetas[3]) - 0.1e-4 * pow(cos(positions.thetas[1]), 0.2e1) * sin(positions.thetas[3])) * cos(positions.thetas[3]) - 0.1885e-1 * sin(positions.thetas[3])) * velocities.velocities[2] + (((0.2e-4 * pow(cos(positions.thetas[1]), 0.2e1) * sin(positions.thetas[3]) + 0.2598e-1 * sin(positions.thetas[3])) * cos(positions.thetas[3]) + 0.1885e-1 * sin(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + ((0.2e-4 * pow(cos(positions.thetas[1]), 0.2e1) * sin(positions.thetas[2]) + 0.2598e-1 * sin(positions.thetas[2])) * pow(cos(positions.thetas[3]), 0.2e1) + 0.1885e-1 * sin(positions.thetas[2]) * cos(positions.thetas[3]) - 0.1299e-1 * sin(positions.thetas[2]) - 0.1e-4 * pow(cos(positions.thetas[1]), 0.2e1) * sin(positions.thetas[2])) * cos(positions.thetas[2]) + (-0.1299e-1 * sin(positions.thetas[3]) - 0.1e-4 * pow(cos(positions.thetas[1]), 0.2e1) * sin(positions.thetas[3])) * cos(positions.thetas[3]) - 0.1885e-1 * sin(positions.thetas[3])) * velocities.velocities[3]) * velocities.velocities[1] + (-0.2e-5 * pow(cos(positions.thetas[2]), 0.2e1) * cos(positions.thetas[3]) * sin(positions.thetas[1]) * cos(positions.thetas[1]) + (0.2e-5 * cos(positions.thetas[1]) * sin(positions.thetas[2]) * sin(positions.thetas[1]) * sin(positions.thetas[3]) + 0.4e-5 * cos(positions.thetas[1]) * sin(positions.thetas[2]) * cos(positions.thetas[3]) * sin(positions.thetas[1]) * sin(positions.thetas[3])) * cos(positions.thetas[2]) + 0.2e-5 * cos(positions.thetas[1]) * sin(positions.thetas[1]) * cos(positions.thetas[3])) * pow(velocities.velocities[2], 0.2e1) + ((-0.80e-5 * pow(cos(positions.thetas[3]), 0.2e1) * cos(positions.thetas[1]) * sin(positions.thetas[1]) + 0.40e-5 * cos(positions.thetas[1]) * sin(positions.thetas[1])) * pow(cos(positions.thetas[2]), 0.2e1) + 0.10e-4 * cos(positions.thetas[1]) * sin(positions.thetas[2]) * sin(positions.thetas[1]) * cos(positions.thetas[2]) * sin(positions.thetas[3]) + 0.40e-5 * pow(cos(positions.thetas[3]), 0.2e1) * cos(positions.thetas[1]) * sin(positions.thetas[1])) * velocities.velocities[3] * velocities.velocities[2] + 0.4e-5 * sin(positions.thetas[1]) * cos(positions.thetas[2]) * pow(velocities.velocities[3], 0.2e1) * cos(positions.thetas[3]) * cos(positions.thetas[1]) * sin(positions.thetas[2]) * sin(positions.thetas[3]);
	returnJointTorques.torques[2] = ((0.2e-4 - 0.2e-4 * pow(cos(positions.thetas[2]), 0.2e1)) * pow(cos(positions.thetas[1]), 0.4e1) + (-0.2e-4 + 0.2e-4 * pow(cos(positions.thetas[2]), 0.2e1)) * pow(cos(positions.thetas[1]), 0.2e1) + (-0.10e-4 + 0.4e-5 * pow(cos(positions.thetas[3]), 0.2e1)) * pow(cos(positions.thetas[2]), 0.2e1) + 0.1885e-1 * cos(positions.thetas[3]) + 0.2967e-1) * accelerations.accelerations[2] + (0.9424e-2 * cos(positions.thetas[3]) + 0.4e-5 * pow(cos(positions.thetas[2]), 0.2e1) * pow(cos(positions.thetas[3]), 0.2e1) - 0.2e-5 * pow(cos(positions.thetas[1]), 0.4e1) * sin(positions.thetas[2]) * cos(positions.thetas[2]) * sin(positions.thetas[3]) + 0.6598e-2) * accelerations.accelerations[3] + 0.2e-5 * accelerations.accelerations[1] * cos(positions.thetas[1]) * sin(positions.thetas[2]) * sin(positions.thetas[1]) * cos(positions.thetas[2]) * cos(positions.thetas[3]) + (((-0.1e-4 * sin(positions.thetas[3]) + 0.16e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + (0.1e-4 * sin(positions.thetas[2]) + 0.16e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1)) * cos(positions.thetas[2]) - 0.6e-5 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.4e1) + (-0.18e-4 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3]) + (-0.1e-4 * sin(positions.thetas[2]) - 0.18e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1)) * cos(positions.thetas[2]) + 0.1e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.2e1) + (-0.2e-5 * sin(positions.thetas[3]) - 0.4e-5 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) - 0.4e-5 * cos(positions.thetas[2]) * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1)) * pow(velocities.velocities[2], 0.2e1) + (((-0.4e-4 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3]) + (-0.4e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) + 0.2e-4 * sin(positions.thetas[2])) * cos(positions.thetas[2]) + 0.2e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.4e1) + (0.4e-4 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3]) + (0.4e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) - 0.2e-4 * sin(positions.thetas[2])) * cos(positions.thetas[2]) - 0.2e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.2e1) - 0.1885e-1 * sin(positions.thetas[3])) * velocities.velocities[3] + ((0.8e-5 * pow(cos(positions.thetas[3]), 0.2e1) * sin(positions.thetas[1]) - 0.2e-5 * sin(positions.thetas[1]) * cos(positions.thetas[3]) - 0.4e-5 * sin(positions.thetas[1])) * pow(cos(positions.thetas[2]), 0.2e1) + 0.4e-5 * sin(positions.thetas[1]) + 0.2e-5 * sin(positions.thetas[1]) * cos(positions.thetas[3]) - 0.4e-5 * pow(cos(positions.thetas[3]), 0.2e1) * sin(positions.thetas[1])) * cos(positions.thetas[1]) * velocities.velocities[1]) * velocities.velocities[2] + ((0.16e-4 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3]) + (-0.6e-5 * sin(positions.thetas[2]) - 0.2e-5 * sin(positions.thetas[2]) * cos(positions.thetas[3]) + 0.16e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1)) * cos(positions.thetas[2]) - 0.6e-5 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.4e1) + (-0.18e-4 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3]) + (0.1e-4 * sin(positions.thetas[2]) - 0.18e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1)) * cos(positions.thetas[2]) + 0.8e-5 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.2e1) - 0.9424e-2 * sin(positions.thetas[3]) - 0.4e-5 * cos(positions.thetas[2]) * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) - 0.4e-5 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(velocities.velocities[3], 0.2e1) + ((0.8e-5 * pow(cos(positions.thetas[3]), 0.2e1) * sin(positions.thetas[1]) - 0.4e-5 * sin(positions.thetas[1])) * pow(cos(positions.thetas[2]), 0.2e1) - 0.10e-4 * sin(positions.thetas[2]) * sin(positions.thetas[1]) * cos(positions.thetas[2]) * sin(positions.thetas[3]) + 0.4e-5 * sin(positions.thetas[1]) - 0.4e-5 * pow(cos(positions.thetas[3]), 0.2e1) * sin(positions.thetas[1])) * cos(positions.thetas[1]) * velocities.velocities[1] * velocities.velocities[3] + (((0.6e-5 * sin(positions.thetas[3]) + 0.4e-5 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + 0.4e-5 * cos(positions.thetas[2]) * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) - 0.4e-5 * sin(positions.thetas[3]) - 0.4e-5 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.2e1) + (-0.1886e-1 * sin(positions.thetas[3]) - 0.1300e-1 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + (-0.1646e-1 * sin(positions.thetas[2]) - 0.1300e-1 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) - 0.1885e-1 * sin(positions.thetas[2]) * cos(positions.thetas[3])) * cos(positions.thetas[2]) + 0.9428e-2 * sin(positions.thetas[3]) + 0.6502e-2 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(velocities.velocities[1], 0.2e1) - 0.4204e0 * sin(positions.thetas[2]) * cos(positions.thetas[3]) - 0.4204e0 * cos(positions.thetas[2]) * sin(positions.thetas[3]) - 0.1070e1 * sin(positions.thetas[2]);
	returnJointTorques.torques[3] = (((-0.4e-5 + 0.2e-5 * cos(positions.thetas[3]) + 0.4e-5 * pow(cos(positions.thetas[3]), 0.2e1)) * pow(cos(positions.thetas[2]), 0.2e1) - 0.2e-5 * cos(positions.thetas[3]) - 0.4e-5 * pow(cos(positions.thetas[3]), 0.2e1)) * pow(cos(positions.thetas[1]), 0.4e1) + 0.9424e-2 * cos(positions.thetas[3]) - 0.4e-5 * pow(cos(positions.thetas[2]), 0.2e1) * pow(cos(positions.thetas[3]), 0.2e1) + 0.6598e-2)* accelerations.accelerations[2] + (0.6598e-2 + ((-0.4e-5 + 0.4e-5 * pow(cos(positions.thetas[3]), 0.2e1)) * pow(cos(positions.thetas[2]), 0.2e1) - 0.4e-5 * pow(cos(positions.thetas[3]), 0.2e1)) * pow(cos(positions.thetas[1]), 0.4e1) + ((0.2e-5 - 0.2e-5 * pow(cos(positions.thetas[3]), 0.2e1)) * pow(cos(positions.thetas[2]), 0.2e1) + 0.2e-5 * pow(cos(positions.thetas[3]), 0.2e1)) * pow(cos(positions.thetas[1]), 0.2e1)) * accelerations.accelerations[3] + (((-0.2e-5 * sin(positions.thetas[3]) + 0.2e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + (-0.1e-4 * sin(positions.thetas[2]) + 0.2e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1)) * cos(positions.thetas[2]) - 0.2e-5 * sin(positions.thetas[3]) - 0.1e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.4e1) + (-0.2e-4 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3]) + (0.1e-4 * sin(positions.thetas[2]) - 0.2e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1)) * cos(positions.thetas[2]) + 0.2e-5 * sin(positions.thetas[3]) + 0.1e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.2e1) + 0.9424e-2 * sin(positions.thetas[3])) * pow(velocities.velocities[2], 0.2e1) + ((((-0.4e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3]) + 0.2e-5 * sin(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + (0.2e-5 * sin(positions.thetas[2]) * cos(positions.thetas[3]) - 0.4e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) + 0.2e-4 * sin(positions.thetas[2])) * cos(positions.thetas[2]) - 0.2e-5 * sin(positions.thetas[3]) + 0.2e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.4e1) + ((0.4e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3]) - 0.2e-5 * sin(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + (-0.2e-5 * sin(positions.thetas[2]) * cos(positions.thetas[3]) + 0.4e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) - 0.2e-4 * sin(positions.thetas[2])) * cos(positions.thetas[2]) - 0.2e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3]) + 0.2e-5 * sin(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.2e1)) * velocities.velocities[3] + ((-0.8e-5 * pow(cos(positions.thetas[3]), 0.2e1) * sin(positions.thetas[1]) + 0.4e-5 * sin(positions.thetas[1])) * pow(cos(positions.thetas[2]), 0.2e1) + (0.3e-5 * sin(positions.thetas[1]) * sin(positions.thetas[2]) * sin(positions.thetas[3]) + 0.2e-5 * sin(positions.thetas[2]) * cos(positions.thetas[3]) * sin(positions.thetas[1]) * sin(positions.thetas[3])) * cos(positions.thetas[2]) - 0.4e-5 * sin(positions.thetas[1]) + 0.4e-5 * pow(cos(positions.thetas[3]), 0.2e1) * sin(positions.thetas[1])) * cos(positions.thetas[1]) * velocities.velocities[1]) * velocities.velocities[2] + ((0.2e-4 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3]) + (-0.1e-4 * sin(positions.thetas[2]) + 0.2e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1)) * cos(positions.thetas[2]) - 0.1e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.4e1) + (-0.2e-4 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3]) + (0.1e-4 * sin(positions.thetas[2]) - 0.2e-4 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1)) * cos(positions.thetas[2]) + 0.1e-4 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.2e1) - 0.4e-5 * cos(positions.thetas[2]) * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) - 0.4e-5 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(velocities.velocities[3], 0.2e1) + ((-0.8e-5 * pow(cos(positions.thetas[3]), 0.2e1) * sin(positions.thetas[1]) + 0.4e-5 * sin(positions.thetas[1])) * pow(cos(positions.thetas[2]), 0.2e1) + 0.2e-5 * sin(positions.thetas[2]) * cos(positions.thetas[3]) * sin(positions.thetas[1]) * cos(positions.thetas[2]) * sin(positions.thetas[3]) - 0.4e-5 * sin(positions.thetas[1]) + 0.4e-5 * pow(cos(positions.thetas[3]), 0.2e1) * sin(positions.thetas[1])) * cos(positions.thetas[1]) * velocities.velocities[1] * velocities.velocities[3] + ((0.4e-5 * cos(positions.thetas[2]) * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) + 0.4e-5 * pow(cos(positions.thetas[2]), 0.2e1) * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[1]), 0.2e1) + (-0.9424e-2 * sin(positions.thetas[3]) - 0.1300e-1 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(cos(positions.thetas[2]), 0.2e1) + (0.6498e-2 * sin(positions.thetas[2]) - 0.1300e-1 * sin(positions.thetas[2]) * pow(cos(positions.thetas[3]), 0.2e1) - 0.9424e-2 * sin(positions.thetas[2]) * cos(positions.thetas[3])) * cos(positions.thetas[2]) + 0.9424e-2 * sin(positions.thetas[3]) + 0.6498e-2 * sin(positions.thetas[3]) * cos(positions.thetas[3])) * pow(velocities.velocities[1], 0.2e1) - 0.4204e0 * sin(positions.thetas[2]) * cos(positions.thetas[3]) - 0.4204e0 * cos(positions.thetas[2]) * sin(positions.thetas[3]);

	return returnJointTorques;
}

